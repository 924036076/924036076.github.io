window.__require=function t(e,o,r){function i(c,a){if(!o[c]){if(!e[c]){var h=c.split("/");if(h=h[h.length-1],!e[h]){var s="function"==typeof __require&&__require;if(!a&&s)return s(h,!0);if(n)return n(h,!0);throw new Error("Cannot find module '"+c+"'")}c=h}var p=o[c]={exports:{}};e[c][0].call(p.exports,function(t){return i(e[c][1][t]||t)},p,p.exports,t,e,o,r)}return o[c].exports}for(var n="function"==typeof __require&&__require,c=0;c<r.length;c++)i(r[c]);return i}({GameController:[function(t,e,o){"use strict";cc._RF.push(e,"749a7kJD4BES4O/jubBLcS6","GameController");var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),n=this&&this.__decorate||function(t,e,o,r){var i,n=arguments.length,c=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(c=(n<3?i(c):n>3?i(e,o,c):i(e,o))||c);return n>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator,a=c.ccclass,h=c.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rectPfb=null,e.currentScore=null,e.ctx=null,e.map=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],e.box_width=null,e.margin_width=null,e.number_color={0:"#ccc0b3",2:"#ffeecd",4:"#ffcb6a",8:"#ffa65a",16:"#ff8545",32:"#ff643f",64:"#e4451e",128:"#bd3b18",256:"#ece688",512:"#f8ec24",1024:"#42f391",2048:"#00ffae"},e.space=16,e.score=0,e.isGameOver=!1,e}return i(e,t),e.prototype.onLoad=function(){var t=cc.winSize;this.node.height=this.node.width=t.width-14;var e=this.node.getChildByName("gameShadowRect");this.ctx=e.getComponent(cc.Graphics),this.box_width=.215*this.node.width,this.margin_width=.14*.2*this.node.width},e.prototype.loop=function(t){for(var e=0;e<4;e++)for(var o=0;o<4;o++)t(e,o)},e.prototype.drawBgShadowRect=function(){var t=this,e=new cc.Color(255,255,255,30);t.loop(function(o,r){var i=0==r?t.margin_width:r*(t.box_width+t.margin_width)+t.margin_width,n=3==o?t.margin_width:(3-o)*(t.box_width+t.margin_width)+t.margin_width;t.ctx.lineWidth=0,t.ctx.rect(i,n,t.box_width,t.box_width),t.ctx.fillColor=e,t.ctx.fill()})},e.prototype.produce=function(){var t=this,e=~~(Math.random()*t.space),o=0;t.loop(function(r,i){0==t.map[r][i]&&(e==o&&(t.map[r][i]=2,t.block()),o+=1)}),t.space-=1},e.prototype.clearNumRects=function(){for(var t=0;t<this.node.children.length;t++)"2048RectPfb"==this.node.children[t].name&&this.node.children[t].destroy()},e.prototype.block=function(){var t=this;t.clearNumRects(),t.loop(function(e,o){var r=t.map[e][o],i=t.number_color[String(r)];0!=r&&t.drawRects(0==o?t.margin_width:o*(t.box_width+t.margin_width)+t.margin_width,3==e?t.margin_width:(3-e)*(t.box_width+t.margin_width)+t.margin_width,t.box_width,i,r)})},e.prototype.drawRects=function(t,e,o,r,i){var n=new cc.Color,c=cc.instantiate(this.rectPfb);c.width=c.height=o,c.setPosition(cc.v2(t,e));var a=c.getChildByName("2048Number");c.getChildByName("2048RectBg").color=n.fromHEX(String(r)),a.color=i<=4?n.fromHEX("#ffb638"):cc.Color.WHITE,a.getComponent(cc.Label).string=i,this.node.addChild(c)},e.prototype.init=function(){for(var t=0;t<2;t++)this.produce()},e.prototype.move=function(t){var e=!1;if(!this.isGameOver){for(var o=0;o<4;o++){for(var r=[],i=!1,n=0;n<4;n++){var c=h(o,n)[0],a=h(o,n)[1];0!=this.map[c][a]&&(i||this.map[c][a]!=r[r.length-1]?(console.log(r[r.length-1]),r.push(this.map[c][a]),console.log(r)):(this.score+=r[r.length-1]*=2,2048==r[r.length-1]&&(this.isGameOver=!0),i=!0,this.space+=1,e||(e=!0),this.currentScore.getComponent(cc.Label).string="score: "+this.score))}for(n=0;n<4;n++)c=h(o,n)[0],a=h(o,n)[1],0==this.map[c][a]&&r[n]>0&&(e||(e=!0)),this.map[c][a]=isNaN(r[n])?0:r[n]}e&&this.space>0&&(this.produce(),e=!1),0==this.space&&this.gameOver()&&!this.isGameOver&&(this.isGameOver=!0)}function h(e,o){var r=e,i=o,n=r;return 0==t[0]&&(r=i,i=n),t[1]>0&&(r=3-r),t[0]>0&&(i=3-i),[r,i]}},e.prototype.gameOver=function(){for(var t=0;t<4;t++)for(var e=0;e<4;e++){var o=0==t?null:[t-1,e],r=3==e?null:[t,e+1],i=3==t?null:[t+1,e],n=0==e?null:[t,e-1];if(o&&this.map[t][e]==this.map[o[0]][o[1]])return!1;if(r&&this.map[t][e]==this.map[r[0]][r[1]])return!1;if(i&&this.map[t][e]==this.map[i[0]][i[1]])return!1;if(n&&this.map[t][e]==this.map[n[0]][n[1]])return!1}return!0},e.prototype.showTheGamePanel=function(){},e.prototype.setWinTimes=function(){},e.prototype.eventHandle=function(){var t,e,o,r,i=this,n=this.node.parent;n.on(cc.Node.EventType.TOUCH_START,function(i){var n=i.getLocation();t=n.x,e=n.y,o=0,r=0},this),n.on(cc.Node.EventType.TOUCH_MOVE,function(i){var n=i.getLocation(),c=n.x,a=n.y;o=c-t,r=a-e},this),n.on(cc.Node.EventType.TOUCH_END,function(){r<-30&&Math.abs(r/o)>2&&i.move([0,1]),r>30&&Math.abs(r/o)>2&&i.move([0,-1]),o<-30&&Math.abs(o/r)>2&&i.move([-1,0]),o>30&&Math.abs(o/r)>2&&i.move([1,0])},this)},e.prototype.start=function(){this.drawBgShadowRect(),this.eventHandle(),this.init()},n([h(cc.Prefab)],e.prototype,"rectPfb",void 0),n([h(cc.Node)],e.prototype,"currentScore",void 0),n([a],e)}(cc.Component);o.default=s,cc._RF.pop()},{}]},{},["GameController"]);